<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Work Vocabulary Master - Learn Professional English for Software Engineers</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
            padding-right: 100px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            margin-top: 40px;
        }

        .header h1 {
            color: white;
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: 800;
        }

        .header p {
            color: rgba(255,255,255,0.9);
            font-size: 1.2rem;
            font-weight: 300;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr auto auto auto;
            gap: 15px;
            margin-bottom: 30px;
            align-items: center;
        }

        .search-box {
            padding: 15px 25px;
            font-size: 16px;
            border: none;
            border-radius: 30px;
            background: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            outline: none;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .search-box:focus {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.15);
        }

        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 30px;
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
        }

        .date-range-container {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .date-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .date-icon {
            position: absolute;
            left: 15px;
            font-size: 16px;
            pointer-events: none;
            z-index: 1;
        }
        
        .date-picker {
            padding: 15px 15px 15px 45px;
            font-size: 16px;
            border: none;
            border-radius: 30px;
            background: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            outline: none;
            transition: all 0.3s ease;
            font-weight: 500;
            cursor: pointer;
            min-width: 160px;
            max-width: 200px;
        }
        
        .date-picker:focus {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.15);
        }
        
        .date-separator {
            color: white;
            font-weight: 500;
            font-size: 16px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 20px 25px;
            color: white;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            background: rgba(255,255,255,0.2);
        }

        .stat-number {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 0.95rem;
            opacity: 0.9;
            font-weight: 500;
        }

        .vocabulary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .word-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .word-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .word-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
        }

        .word-title {
            font-size: 2rem;
            font-weight: 800;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .speaker-icon {
            font-size: 1.5rem;
            cursor: pointer;
            color: #764ba2;
            transition: all 0.2s ease;
        }

        .speaker-icon:hover {
            color: #667eea;
            transform: scale(1.1);
        }

        .word-meaning {
            margin-bottom: 20px;
        }

        .word-meaning h4 {
            color: #667eea;
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .word-meaning p {
            color: #34495e;
            font-size: 1.1rem;
            line-height: 1.7;
        }

        .word-usage {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 0 10px 10px 0;
            font-style: italic;
            color: #555;
        }

        .word-examples {
            margin-top: 20px;
        }

        .example-category {
            margin-bottom: 15px;
        }

        .example-category h5 {
            color: #764ba2;
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .example-item {
            background: rgba(102, 126, 234, 0.08);
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 5px;
            font-style: italic;
            border-left: 3px solid #667eea;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(8px);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            position: relative;
            background: white;
            border-radius: 25px;
            padding: 40px;
            max-width: 900px;
            margin: 50px auto;
            width: 95%;
            box-shadow: 0 25px 80px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #eee;
        }

        .modal-title-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-grow: 1;
            margin-right: 15px;
        }

        .modal-header h2 {
            font-size: 2.5rem;
            font-weight: 800;
            color: #2c3e50;
        }

        .modal-date-badge {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: #666;
            transition: all 0.3s ease;
            padding: 5px;
            border-radius: 50%;
        }

        .close-btn:hover {
            color: #333;
            background: #f0f0f0;
        }

        .modal-section {
            margin-bottom: 30px;
        }

        .modal-section h3 {
            color: #667eea;
            font-weight: 700;
            margin-bottom: 15px;
            font-size: 1.3rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .story-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
            font-size: 1.1rem;
            line-height: 1.8;
            color: #2c3e50;
        }

        .related-words {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .related-word {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #764ba2;
        }

        .related-word h4 {
            color: #764ba2;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .no-results {
            text-align: center;
            color: white;
            font-size: 1.3rem;
            margin: 50px 0;
            font-weight: 300;
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 1.2rem;
            margin: 40px 0;
        }


        .modal-actions {
            text-align: center;
            margin-top: 40px;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            body {
                padding-right: 0;
                padding-bottom: 80px;
            }
            
            .header {
                margin-top: 20px;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .controls {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            /* Hide desktop menu, show mobile menu */
            .sidebar-menu.desktop-menu {
                display: none !important;
            }
            
            .mobile-bottom-menu {
                display: flex !important;
            }
            
            /* Mobile bottom navigation bar */
            .sidebar-menu {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                transform: none;
                width: 100%;
                flex-direction: row;
                background: rgba(255, 255, 255, 0.98);
                backdrop-filter: blur(20px);
                border-radius: 0;
                padding: 15px 20px;
                padding-bottom: calc(15px + env(safe-area-inset-bottom));
                box-shadow: 0 -5px 30px rgba(0,0,0,0.15);
                gap: 0;
                justify-content: center;
                border-top: 1px solid rgba(0,0,0,0.1);
            }
            
            .menu-item {
                padding: 10px 30px;
                min-width: auto;
                border-radius: 15px;
                flex-direction: column;
                align-items: center;
                display: flex;
                flex: 1;
                max-width: 120px;
            }
            
            .menu-item-icon {
                font-size: 22px;
                margin-bottom: 4px;
            }
            
            .menu-item-text {
                font-size: 11px;
                font-weight: 600;
            }
            
            /* Mobile stories grid - single column */
            .stories-grid {
                grid-template-columns: 1fr !important;
                gap: 15px;
                margin: 0 10px;
            }
            
            /* Mobile dialogues grid - single column */
            .dialogues-grid {
                grid-template-columns: 1fr !important;
                gap: 15px;
                margin: 0 10px;
            }
            
            .story-card {
                padding: 18px;
                margin: 0;
                width: 100%;
                box-sizing: border-box;
            }
            
            .story-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
                margin-bottom: 12px;
            }
            
            .story-title {
                font-size: 1.2rem;
                line-height: 1.3;
                margin: 0;
                word-wrap: break-word;
            }
            
            .story-date {
                align-self: flex-start;
                margin-left: 0;
                font-size: 0.75rem;
                padding: 4px 8px;
            }
            
            .story-preview {
                font-size: 0.9rem;
                line-height: 1.4;
                margin-bottom: 12px;
                -webkit-line-clamp: 3;
                word-wrap: break-word;
            }
            
            .story-vocabulary-count {
                font-size: 0.8rem;
                padding: 5px 10px;
            }
            
            .story-modal-content {
                padding: 25px;
                margin: 20px auto;
            }
            
            .story-modal-title {
                font-size: 1.8rem;
            }
            
            .story-text {
                font-size: 1.1rem;
            }
            
            .date-range-container {
                flex-direction: row;
                gap: 8px;
                width: 100%;
                justify-content: space-between;
            }
            
            .date-input-wrapper {
                flex: 1;
            }
            
            .date-picker {
                width: 100%;
                min-width: auto;
                max-width: none;
                padding: 12px 12px 12px 35px;
                font-size: 14px;
            }
            
            .date-icon {
                left: 10px;
                font-size: 14px;
            }
            
            .date-separator {
                font-size: 14px;
                flex-shrink: 0;
                padding: 0 2px;
            }
            
            .vocabulary-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                padding: 25px;
                margin: 20px auto;
            }
            
            .word-title {
                font-size: 1.6rem;
            }
            
            .modal-header h2 {
                font-size: 2rem;
            }
            
            .modal-actions {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }
            
            .modal-actions .btn {
                width: 100%;
                margin: 0;
                padding: 18px 20px;
                font-size: 16px;
                min-height: 56px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding-right: 0;
                padding-bottom: 75px;
            }
            
            .header {
                margin-top: 15px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .date-range-container {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }
            
            .date-separator {
                text-align: center;
                font-size: 12px;
            }
            
            .date-picker {
                padding: 14px 14px 14px 40px;
            }
            
            .date-icon {
                left: 12px;
            }
            
            /* Small mobile bottom navigation */
            .sidebar-menu {
                padding: 12px 15px;
                padding-bottom: calc(12px + env(safe-area-inset-bottom));
            }
            
            .menu-item {
                padding: 8px 25px;
                border-radius: 12px;
            }
            
            .menu-item-icon {
                font-size: 20px;
                margin-bottom: 3px;
            }
            
            .menu-item-text {
                font-size: 10px;
                font-weight: 700;
            }
            
            /* Small mobile optimization */
            .stories-grid {
                gap: 12px;
                margin: 0 8px;
            }
            
            .story-card {
                padding: 15px;
            }
            
            .story-header {
                gap: 6px;
                margin-bottom: 10px;
            }
            
            .story-title {
                font-size: 1.1rem;
                line-height: 1.2;
            }
            
            .story-date {
                font-size: 0.7rem;
                padding: 3px 6px;
            }
            
            .story-preview {
                font-size: 0.85rem;
                line-height: 1.3;
                margin-bottom: 10px;
                -webkit-line-clamp: 2;
            }
            
            .story-vocabulary-count {
                font-size: 0.75rem;
                padding: 4px 8px;
            }
            
            .story-modal-content {
                padding: 20px;
                margin: 10px;
                margin-bottom: 90px;
            }
            
            .story-text {
                font-size: 1rem;
                line-height: 1.6;
                text-align: left;
            }
            
            /* Mobile dialogue modal styles */
            .dialogue-modal-content {
                padding: 25px;
                margin: 20px auto;
                max-height: 85vh;
            }
            
            .dialogue-modal-title {
                font-size: 1.8rem;
            }
            
            .dialogue-section {
                padding: 20px;
            }
            
            .dialogue-line {
                margin-left: 0 !important;
                margin-right: 0 !important;
                padding: 12px;
            }
            
            .dialogue-text {
                font-size: 1rem;
            }
        }

        /* Keep desktop sidebar for larger screens */
        @media (min-width: 769px) {
            body {
                padding-right: 100px;
                padding-bottom: 0;
            }
            
            .sidebar-menu {
                position: fixed;
                top: 50%;
                right: 20px;
                left: auto;
                bottom: auto;
                transform: translateY(-50%);
                flex-direction: column;
                gap: 10px;
                padding: 15px;
                border-radius: 25px;
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(10px);
                box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            }
            
            .menu-item {
                padding: 15px 20px;
                border-radius: 20px;
                min-width: 50px;
                flex-direction: column;
                display: flex;
                align-items: center;
            }
            
            .menu-item-icon {
                font-size: 20px;
                margin-bottom: 5px;
            }
            
            .menu-item-text {
                font-size: 10px;
                font-weight: 700;
            }
        }

        /* Flash Card Styles */
        .flash-card-container {
            position: relative;
            max-width: 1000px;
            margin: 30px auto;
            width: 95%;
        }

        .flash-card {
            perspective: 1000px;
            height: 500px;
            cursor: pointer;
        }

        .flash-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }

        .flash-card.flipped .flash-card-inner {
            transform: rotateY(180deg);
        }

        .flash-card-front, .flash-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 20px;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }
        
        .flash-card-front {
            justify-content: center;
        }
        
        .flash-card-back {
            justify-content: flex-start;
            overflow-y: auto;
        }

        .flash-card-front {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .flash-card-back {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
            transform: rotateY(180deg);
        }

        .flash-card-header {
            margin-bottom: 40px;
            flex-shrink: 0;
        }
        
        .flash-card-front .flash-card-header {
            margin-bottom: 20px;
        }

        .flash-card-header h2 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            line-height: 1.2;
        }

        .flash-card-date {
            background: rgba(255,255,255,0.2);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .flash-card-hint {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1rem;
            opacity: 0.8;
            font-style: italic;
            font-weight: 500;
        }

        .flash-card-content {
            width: 100%;
            flex-grow: 1;
            overflow-y: auto;
        }

        .flash-meaning {
            margin-bottom: 25px;
        }

        .flash-meaning h3 {
            font-size: 1.4rem;
            margin-bottom: 12px;
            font-weight: 700;
            color: rgba(255,255,255,0.9);
        }

        .flash-meaning p {
            font-size: 1.2rem;
            line-height: 1.7;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .flash-usage {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-style: italic;
            font-size: 1.1rem;
            line-height: 1.6;
            border-left: 4px solid rgba(255,255,255,0.3);
        }

        .flash-example {
            font-size: 1rem;
            font-style: italic;
            opacity: 0.95;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            line-height: 1.5;
        }

        .flash-card-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        /* Stories Styles */
        .stories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        /* Dialogues Styles */
        .dialogues-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .dialogue-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .dialogue-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
        }

        .dialogue-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
        }

        .dialogue-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .dialogue-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: #2c3e50;
            margin: 0;
            line-height: 1.3;
        }

        .dialogue-date {
            background: #4ecdc4;
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
            margin-left: 15px;
        }

        .dialogue-preview {
            color: #555;
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 20px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }

        .dialogue-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .dialogue-stat {
            background: rgba(78, 205, 196, 0.1);
            color: #4ecdc4;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            display: inline-block;
        }

        .story-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .story-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
        }

        .story-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
        }

        .story-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .story-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: #2c3e50;
            margin: 0;
            line-height: 1.3;
        }

        .story-date {
            background: #667eea;
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
            margin-left: 15px;
        }

        .story-preview {
            color: #555;
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 20px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
        }

        .story-vocabulary-count {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            display: inline-block;
        }

        .story-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(8px);
            z-index: 1000;
            overflow-y: auto;
        }

        .story-modal-content {
            position: relative;
            background: white;
            border-radius: 25px;
            padding: 40px;
            max-width: 1000px;
            margin: 50px auto;
            width: 95%;
            box-shadow: 0 25px 80px rgba(0,0,0,0.3);
        }

        .story-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #eee;
        }

        .story-modal-title {
            font-size: 2.2rem;
            font-weight: 800;
            color: #2c3e50;
            margin: 0;
        }

        .story-text {
            font-size: 1.2rem;
            line-height: 1.8;
            color: #333;
            margin-bottom: 30px;
            text-align: justify;
        }

        .highlighted-word {
            background: linear-gradient(135deg, #667eea, #764ba2);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .highlighted-word:hover {
            transform: scale(1.05);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .word-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #2c3e50;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1001;
            pointer-events: none;
        }

        .word-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #2c3e50;
        }

        .highlighted-word:hover .word-tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* Dialogue Modal Styles */
        .dialogue-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 1000;
            overflow-y: auto;
        }

        .dialogue-modal-content {
            position: relative;
            background: white;
            padding: 40px;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            overflow-y: auto;
        }

        .dialogue-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .dialogue-modal-title {
            font-size: 2.2rem;
            font-weight: 800;
            color: #2c3e50;
            margin: 0;
        }

        .dialogue-sections {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .dialogue-two-column {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .dialogue-two-column {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .dialogue-section {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.08), rgba(68, 160, 141, 0.05));
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #4ecdc4;
            border: 1px solid rgba(78, 205, 196, 0.2);
        }

        .dialogue-section h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin: 0 0 20px 0;
        }

        /* Conversation Styles */
        .dialogue-line {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 12px;
            position: relative;
        }

        .dialogue-line.speaker-first .dialogue-speaker {
            color: #4ecdc4;
        }
        
        .dialogue-line.speaker-first {
            border-left: 4px solid #4ecdc4;
        }

        .dialogue-line.speaker-second .dialogue-speaker {
            color: #e74c3c;
        }
        
        .dialogue-line.speaker-second {
            border-left: 4px solid #e74c3c;
        }

        .dialogue-speaker {
            font-weight: 700;
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .dialogue-text {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .dialogue-bahasa {
            font-size: 1rem;
            opacity: 0.8;
            font-style: italic;
            cursor: pointer;
            border-top: 1px solid rgba(255,255,255,0.2);
            padding-top: 8px;
            display: none;
        }

        .dialogue-bahasa.show {
            display: block;
        }

        .toggle-translation {
            background: #4ecdc4;
            color: white;
            border: 1px solid #4ecdc4;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-top: 8px;
            transition: all 0.3s ease;
        }

        .toggle-translation:hover {
            background: #44a08d;
            border-color: #44a08d;
        }

        /* Expression Styles */
        .expression-item {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.05), rgba(68, 160, 141, 0.02));
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 3px solid #4ecdc4;
            border: 1px solid rgba(78, 205, 196, 0.15);
            box-shadow: 0 2px 8px rgba(78, 205, 196, 0.1);
        }

        .expression-phrase {
            font-size: 1.1rem;
            font-weight: 700;
            color: white;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 8px 12px;
            border-radius: 8px;
            display: inline-block;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .expression-meaning {
            color: #555;
            line-height: 1.5;
            margin-bottom: 6px;
            font-size: 0.95rem;
        }

        .expression-bahasa {
            color: #777;
            font-style: italic;
            display: none;
            font-size: 0.9rem;
        }

        .expression-bahasa.show {
            display: block;
        }

        /* Fix button styling in expressions section */
        .dialogue-expressions .toggle-translation {
            background: #4ecdc4;
            color: white;
            border: 1px solid #4ecdc4;
        }

        .dialogue-expressions .toggle-translation:hover {
            background: #44a08d;
            border-color: #44a08d;
        }

        /* Question Styles */
        .question-item {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.05), rgba(68, 160, 141, 0.02));
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #4ecdc4;
            border: 1px solid rgba(78, 205, 196, 0.15);
            box-shadow: 0 2px 10px rgba(78, 205, 196, 0.1);
        }

        .question-q {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .question-answer {
            color: #555;
            line-height: 1.6;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #ff6b6b;
            display: none;
        }

        .question-answer.show {
            display: block;
        }

        .show-answer-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .show-answer-btn:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }

        /* Desktop Sticky Sidebar Menu */
        .sidebar-menu.desktop-menu {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* Mobile Bottom Navigation Menu */
        .mobile-bottom-menu {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0,0,0,0.1);
            padding: 12px 0;
            padding-bottom: calc(12px + env(safe-area-inset-bottom));
            box-shadow: 0 -5px 30px rgba(0,0,0,0.15);
            z-index: 999;
            display: none;
            justify-content: center;
            gap: 0;
        }

        .mobile-menu-item {
            flex: 1;
            max-width: 150px;
            padding: 8px 16px;
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            border-radius: 12px;
            margin: 0 8px;
        }

        .mobile-menu-item.active {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .mobile-menu-item.active .mobile-menu-icon {
            color: #667eea;
        }

        .mobile-menu-item:hover:not(.active) {
            background: rgba(102, 126, 234, 0.05);
        }

        .mobile-menu-icon {
            font-size: 24px;
            margin-bottom: 4px;
            color: #666;
            transition: color 0.3s ease;
        }

        .mobile-menu-text {
            font-size: 11px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .mobile-menu-item.active .mobile-menu-text {
            color: #667eea;
            font-weight: 700;
        }
        
        /* Cache Info Modal Styles */
        .cache-info-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            overflow-y: auto;
        }
        
        .cache-info-modal-content {
            position: relative;
            background: white;
            padding: 30px;
            margin: 50px auto;
            max-width: 600px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .cache-info-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .cache-info-modal-header h3 {
            font-size: 1.8rem;
            font-weight: 800;
            color: #2c3e50;
            margin: 0;
        }
        
        .cache-info-body {
            color: #2c3e50;
            line-height: 1.6;
        }
        
        .cache-info-body p {
            margin-bottom: 15px;
        }
        
        .cache-detail-item {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.08), rgba(68, 160, 141, 0.05));
            border-left: 4px solid #4ecdc4;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        
        .cache-detail-item strong {
            color: #4ecdc4;
        }
        
        .cache-expired {
            border-left-color: #e74c3c;
        }
        
        .cache-expired strong {
            color: #e74c3c;
        }
        
        /* Desktop - show sidebar, hide mobile menu */
        @media (min-width: 769px) {
            body {
                padding-right: 100px;
                padding-bottom: 0;
            }
            
            .sidebar-menu.desktop-menu {
                display: flex !important;
            }
            
            .mobile-bottom-menu {
                display: none !important;
            }
        }

        .menu-item {
            padding: 15px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-align: center;
            min-width: 50px;
            background: transparent;
            border: none;
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
        }

        .menu-item.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .menu-item:hover:not(.active) {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            transform: scale(1.02);
        }

        .menu-item-icon {
            display: block;
            font-size: 20px;
            margin-bottom: 5px;
        }

        .menu-item-text {
            font-size: 10px;
            font-weight: 700;
        }

        .flash-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .flash-btn.primary {
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            color: white;
        }

        .flash-btn.secondary {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
        }

        .flash-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .flash-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .flash-close-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            .flash-card-container {
                max-width: 95%;
                margin: 20px auto;
            }

            .flash-card {
                height: 450px;
            }

            .flash-card-front, .flash-card-back {
                padding: 25px;
            }

            .flash-card-header {
                margin-bottom: 30px;
            }

            .flash-card-header h2 {
                font-size: 2.2rem;
            }

            .flash-meaning h3 {
                font-size: 1.2rem;
            }

            .flash-meaning p {
                font-size: 1.1rem;
            }

            .flash-usage {
                font-size: 1rem;
                padding: 18px;
            }

            .flash-example {
                font-size: 0.95rem;
            }

            .flash-card-controls {
                margin-top: 20px;
                gap: 10px;
            }

            .flash-btn {
                padding: 10px 16px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .flash-card {
                height: 400px;
            }

            .flash-card-front, .flash-card-back {
                padding: 20px;
            }

            .flash-card-header h2 {
                font-size: 1.8rem;
            }

            .flash-meaning h3 {
                font-size: 1.1rem;
            }

            .flash-meaning p {
                font-size: 1rem;
            }

            .flash-usage {
                font-size: 0.95rem;
                padding: 15px;
            }

            .flash-example {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="headerTitle">💼 Daily Work Vocabulary Master</h1>
            <p id="headerSubtitle">Learn everyday vocabulary for software engineers - from meetings to code reviews</p>
        </div>

        <div class="controls" id="controlsSection">
            <input type="text" class="search-box" placeholder="Search words, meanings, or workplace examples..." id="searchInput">
            <div class="date-range-container" id="dateRangeContainer">
                <div class="date-input-wrapper">
                    <span class="date-icon">📅</span>
                    <input type="date" class="date-picker" id="startDate" onchange="handleDateRangeChange()" placeholder="From">
                </div>
                <span class="date-separator">to</span>
                <div class="date-input-wrapper">
                    <span class="date-icon">📅</span>
                    <input type="date" class="date-picker" id="endDate" onchange="handleDateRangeChange()" placeholder="To">
                </div>
            </div>
            <button class="btn" id="shuffleBtn" onclick="shuffleWords()">🎲 Shuffle</button>
            <button class="btn secondary" id="randomBtn" onclick="showRandomWord()">🎯 Random Word</button>
        </div>


        <div class="stats" id="statsSection">
            <div class="stat-card">
                <div class="stat-number" id="totalWords">0</div>
                <div class="stat-label">Total Words</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="displayedWords">0</div>
                <div class="stat-label">Showing</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="learnedWords">0</div>
                <div class="stat-label">Learned</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="loadedDates">0</div>
                <div class="stat-label">Vocab Sets</div>
            </div>
        </div>

        <div class="vocabulary-grid" id="vocabularyGrid">
            <!-- Words will be inserted here -->
        </div>

        <div class="stories-grid" id="storiesGrid" style="display: none;">
            <!-- Stories will be inserted here -->
        </div>

        <div class="dialogues-grid" id="dialoguesGrid" style="display: none;">
            <!-- Dialogues will be inserted here -->
        </div>

        <div class="loading" id="loading" style="display: none;">
            <span id="loadingText">Loading daily vocabulary...</span>
            <div id="cacheIndicator" style="font-size: 0.9rem; opacity: 0.8; margin-top: 5px;"></div>
        </div>

        <div class="no-results" id="noResults" style="display: none;">
            No words found matching your search.
        </div>
    </div>

    <!-- Desktop Sticky Sidebar Menu -->
    <div class="sidebar-menu desktop-menu">
        <button class="menu-item active" id="vocabularyMenuItemDesktop" onclick="showVocabulary()">
            <span class="menu-item-icon">📚</span>
            <span class="menu-item-text">Vocab</span>
        </button>
        <button class="menu-item" id="storiesMenuItemDesktop" onclick="showStories()">
            <span class="menu-item-icon">📖</span>
            <span class="menu-item-text">Stories</span>
        </button>
        <button class="menu-item" id="dialoguesMenuItemDesktop" onclick="showDialogues()">
            <span class="menu-item-icon">💬</span>
            <span class="menu-item-text">Dialogues</span>
        </button>
        <button class="menu-item info-menu-item" id="infoMenuItemDesktop" onclick="toggleCacheInfo()">
            <span class="menu-item-icon">ℹ️</span>
            <span class="menu-item-text">Info</span>
        </button>
    </div>

    <!-- Mobile Bottom Navigation Menu -->
    <div class="mobile-bottom-menu">
        <button class="mobile-menu-item active" id="vocabularyMenuItemMobile" onclick="showVocabulary()">
            <span class="mobile-menu-icon">📚</span>
            <span class="mobile-menu-text">Vocabulary</span>
        </button>
        <button class="mobile-menu-item" id="storiesMenuItemMobile" onclick="showStories()">
            <span class="mobile-menu-icon">📖</span>
            <span class="mobile-menu-text">Stories</span>
        </button>
        <button class="mobile-menu-item" id="dialoguesMenuItemMobile" onclick="showDialogues()">
            <span class="mobile-menu-icon">💬</span>
            <span class="mobile-menu-text">Dialogues</span>
        </button>
        <button class="mobile-menu-item info-menu-item" id="infoMenuItemMobile" onclick="toggleCacheInfo()">
            <span class="mobile-menu-icon">ℹ️</span>
            <span class="mobile-menu-text">Info</span>
        </button>
    </div>

    <!-- Modal for detailed view -->
    <div class="modal" id="wordModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title-section">
                    <h2 id="modalTitle"></h2>
                    <span class="modal-date-badge" id="modalDate" style="display: none;"></span>
                </div>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- Flash Card Modal -->
    <div class="modal" id="flashCardModal" style="display: none;">
        <div class="flash-card-container">
            <div class="flash-card" id="flashCard">
                <div class="flash-card-inner">
                    <div class="flash-card-front">
                        <div class="flash-card-header">
                            <h2 id="flashCardWord"></h2>
                            <span class="flash-card-date" id="flashCardDate"></span>
                        </div>
                        <div class="flash-card-hint">💡 Tap to reveal meaning</div>
                    </div>
                    <div class="flash-card-back">
                        <div class="flash-card-content">
                            <div class="flash-meaning" id="flashMeaning"></div>
                            <div class="flash-usage" id="flashUsage"></div>
                            <div class="flash-example" id="flashExample"></div>
                        </div>
                        <div class="flash-card-hint">💡 Tap again to see front</div>
                    </div>
                </div>
            </div>
            <div class="flash-card-controls">
                <button class="flash-btn secondary" onclick="closeFlashCard()">📚 Continue</button>
                <button class="flash-btn" onclick="showNextFlashCard()">➡️ Next Word</button>
                <button class="flash-btn primary" onclick="markFlashCardLearned()">✅ Learned</button>
            </div>
            <button class="flash-close-btn" onclick="closeFlashCard()">&times;</button>
        </div>
    </div>

    <!-- Story Modal -->
    <div class="story-modal" id="storyModal">
        <div class="story-modal-content">
            <div class="story-modal-header">
                <h2 class="story-modal-title" id="storyModalTitle"></h2>
                <button class="close-btn" onclick="closeStoryModal()">&times;</button>
            </div>
            <div class="story-text" id="storyText"></div>
            <div class="modal-actions">
                <button class="btn" id="listenToStoryBtn">🔊 Listen to Story</button>
                <button class="btn secondary" onclick="closeStoryModal()">📚 Back to Stories</button>
            </div>
        </div>
    </div>

    <!-- Dialog Modal -->
    <div class="dialogue-modal" id="dialogueModal">
        <div class="dialogue-modal-content">
            <div class="dialogue-modal-header">
                <h2 class="dialogue-modal-title" id="dialogueModalTitle"></h2>
                <button class="close-btn" onclick="closeDialogueModal()">&times;</button>
            </div>
            <div class="dialogue-two-column">
                <div class="dialogue-section">
                    <h3>💬 Conversation</h3>
                    <div class="dialogue-conversation" id="dialogueConversation"></div>
                </div>
                <div class="dialogue-section">
                    <h3>📝 Key Expressions</h3>
                    <div class="dialogue-expressions" id="dialogueExpressions"></div>
                </div>
            </div>
            <div class="dialogue-sections">
                <div class="dialogue-section">
                    <h3>❓ Comprehension Questions</h3>
                    <div class="dialogue-questions" id="dialogueQuestions"></div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn secondary" onclick="closeDialogueModal()">💬 Back to Dialogues</button>
            </div>
        </div>
    </div>

    <!-- Cache Info Modal -->
    <div class="cache-info-modal" id="cacheInfoModal" style="display: none;">
        <div class="cache-info-modal-content">
            <div class="cache-info-modal-header">
                <h3>📦 Cache Information</h3>
                <button class="close-btn" onclick="closeCacheInfo()">&times;</button>
            </div>
            <div class="cache-info-body" id="cacheInfoBody">
                <p>We cache content locally to improve performance and reduce loading times.</p>
                <p><strong>Cache expires every 15 minutes</strong> - after which fresh content will be automatically fetched.</p>
                <div id="cacheDetails"></div>
            </div>
        </div>
    </div>

    <script>
        let allVocabulary = [];
        let currentVocabulary = [];
        let voices = [];

        function loadVoices() {
            voices = window.speechSynthesis.getVoices();
        }

        // Load voices initially and on change
        window.speechSynthesis.onvoiceschanged = loadVoices;
        loadVoices();

        function speak(text, lang = 'en-US', event) {
            if (event) {
                event.stopPropagation(); // Prevent the card from opening
            }

            // Stop any previous speech
            window.speechSynthesis.cancel();

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;

            // Find a preferred voice
            const selectedVoice = voices.find(voice => voice.lang === lang && voice.name.includes('Google'));
            if (selectedVoice) {
                utterance.voice = selectedVoice;
            }

            window.speechSynthesis.speak(utterance);
        }
        let learnedCount = 0;
        let loadedDates = new Set();
        let allStories = [];
        let showingStories = false;
        let allDialogues = [];
        let showingDialogues = false;
        
        // Cache configuration
        const CACHE_EXPIRY_MINUTES = 15; // Cache expires after 15 minutes
        const CACHE_KEYS = {
            VOCABULARY: 'vocab_cache_',
            VOCABULARY_TIMESTAMP: 'vocab_cache_timestamp_',
            STORIES: 'stories_cache',
            STORIES_TIMESTAMP: 'stories_cache_timestamp',
            STORIES_DATERANGE: 'stories_daterange_cache_',
            STORIES_DATERANGE_TIMESTAMP: 'stories_daterange_timestamp_',
            DIALOGUES: 'dialogues_cache',
            DIALOGUES_TIMESTAMP: 'dialogues_cache_timestamp'
        };

        // Base URLs for the repository
        const VOCAB_BASE_URL = 'https://raw.githubusercontent.com/muhfaris/english-vocabulary/refs/heads/main/vocabularies/';
        const STORIES_BASE_URL = 'https://raw.githubusercontent.com/muhfaris/english-vocabulary/refs/heads/main/stories/';
        const DIALOGUES_BASE_URL = 'https://raw.githubusercontent.com/muhfaris/english-vocabulary/refs/heads/main/dialogues/';
        
        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        function generateRecentDates(days = 30) {
            const dates = [];
            const today = new Date();
            for (let i = 0; i < days; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                dates.push(formatDate(date));
            }
            return dates;
        }

        // Cache management functions
        function getCacheKey(date) {
            return CACHE_KEYS.VOCABULARY + date;
        }
        
        function getTimestampKey(date) {
            return CACHE_KEYS.VOCABULARY_TIMESTAMP + date;
        }
        
        function isCacheExpired(date) {
            const timestampKey = getTimestampKey(date);
            const timestamp = localStorage.getItem(timestampKey);
            
            if (!timestamp) return true;
            
            const cacheTime = new Date(parseInt(timestamp));
            const now = new Date();
            const minutesDiff = (now - cacheTime) / (1000 * 60);
            
            return minutesDiff > CACHE_EXPIRY_MINUTES;
        }
        
        function getCachedVocabulary(date) {
            if (isCacheExpired(date)) {
                // Remove expired cache
                localStorage.removeItem(getCacheKey(date));
                localStorage.removeItem(getTimestampKey(date));
                return null;
            }
            
            const cached = localStorage.getItem(getCacheKey(date));
            return cached ? JSON.parse(cached) : null;
        }
        
        function setCachedVocabulary(date, data) {
            try {
                localStorage.setItem(getCacheKey(date), JSON.stringify(data));
                localStorage.setItem(getTimestampKey(date), Date.now().toString());
            } catch (error) {
                console.warn('Could not cache vocabulary data:', error.message);
                // If localStorage is full, clear old cache entries
                clearOldCache();
            }
        }
        
        function clearOldCache() {
            const keysToRemove = [];
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && (key.startsWith(CACHE_KEYS.VOCABULARY) || key.startsWith(CACHE_KEYS.VOCABULARY_TIMESTAMP))) {
                    const date = key.replace(CACHE_KEYS.VOCABULARY, '').replace(CACHE_KEYS.VOCABULARY_TIMESTAMP, '');
                    if (isCacheExpired(date)) {
                        keysToRemove.push(key);
                    }
                }
            }
            
            keysToRemove.forEach(key => localStorage.removeItem(key));
        }
        
        function getCacheInfo() {
            const cacheEntries = [];
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.startsWith(CACHE_KEYS.VOCABULARY)) {
                    const date = key.replace(CACHE_KEYS.VOCABULARY, '');
                    const timestamp = localStorage.getItem(getTimestampKey(date));
                    const data = localStorage.getItem(key);
                    
                    if (timestamp && data) {
                        cacheEntries.push({
                            date,
                            timestamp: new Date(parseInt(timestamp)),
                            expired: isCacheExpired(date),
                            size: data.length
                        });
                    }
                }
            }
            
            return cacheEntries;
        }
        
        // Generic cache functions for all data types
        function isCacheExpiredGeneric(timestampKey) {
            const timestamp = localStorage.getItem(timestampKey);
            
            if (!timestamp) return true;
            
            const cacheTime = new Date(parseInt(timestamp));
            const now = new Date();
            const minutesDiff = (now - cacheTime) / (1000 * 60);
            
            return minutesDiff > CACHE_EXPIRY_MINUTES;
        }
        
        function getCachedData(cacheKey, timestampKey) {
            if (isCacheExpiredGeneric(timestampKey)) {
                return null;
            }
            
            const data = localStorage.getItem(cacheKey);
            return data ? JSON.parse(data) : null;
        }
        
        function setCachedData(cacheKey, timestampKey, data) {
            localStorage.setItem(cacheKey, JSON.stringify(data));
            localStorage.setItem(timestampKey, Date.now().toString());
        }
        
        // Stories cache functions
        function getCachedStories() {
            return getCachedData(CACHE_KEYS.STORIES, CACHE_KEYS.STORIES_TIMESTAMP);
        }
        
        function setCachedStories(data) {
            setCachedData(CACHE_KEYS.STORIES, CACHE_KEYS.STORIES_TIMESTAMP, data);
        }
        
        // Stories date range cache functions
        function getCachedStoriesDateRange(startDate, endDate) {
            const cacheKey = `${CACHE_KEYS.STORIES_DATERANGE}${startDate}_${endDate}`;
            const timestampKey = `${CACHE_KEYS.STORIES_DATERANGE_TIMESTAMP}${startDate}_${endDate}`;
            return getCachedData(cacheKey, timestampKey);
        }
        
        function setCachedStoriesDateRange(startDate, endDate, data) {
            const cacheKey = `${CACHE_KEYS.STORIES_DATERANGE}${startDate}_${endDate}`;
            const timestampKey = `${CACHE_KEYS.STORIES_DATERANGE_TIMESTAMP}${startDate}_${endDate}`;
            setCachedData(cacheKey, timestampKey, data);
        }
        
        // Dialogues cache functions
        function getCachedDialogues() {
            return getCachedData(CACHE_KEYS.DIALOGUES, CACHE_KEYS.DIALOGUES_TIMESTAMP);
        }
        
        function setCachedDialogues(data) {
            setCachedData(CACHE_KEYS.DIALOGUES, CACHE_KEYS.DIALOGUES_TIMESTAMP, data);
        }
        
        // Updated cache info function to include all data types
        function getAllCacheInfo() {
            const info = {
                vocabulary: getCacheInfo(),
                stories: null,
                storiesDateRanges: [],
                dialogues: null,
                cacheExpiry: `${CACHE_EXPIRY_MINUTES} minutes`
            };
            
            // Check stories cache
            const storiesTimestamp = localStorage.getItem(CACHE_KEYS.STORIES_TIMESTAMP);
            if (storiesTimestamp) {
                info.stories = {
                    timestamp: new Date(parseInt(storiesTimestamp)),
                    expired: isCacheExpiredGeneric(CACHE_KEYS.STORIES_TIMESTAMP),
                    size: localStorage.getItem(CACHE_KEYS.STORIES)?.length || 0
                };
            }
            
            // Check dialogues cache
            const dialoguesTimestamp = localStorage.getItem(CACHE_KEYS.DIALOGUES_TIMESTAMP);
            if (dialoguesTimestamp) {
                info.dialogues = {
                    timestamp: new Date(parseInt(dialoguesTimestamp)),
                    expired: isCacheExpiredGeneric(CACHE_KEYS.DIALOGUES_TIMESTAMP),
                    size: localStorage.getItem(CACHE_KEYS.DIALOGUES)?.length || 0
                };
            }
            
            // Check date range stories caches
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.startsWith(CACHE_KEYS.STORIES_DATERANGE_TIMESTAMP)) {
                    const dateRange = key.replace(CACHE_KEYS.STORIES_DATERANGE_TIMESTAMP, '');
                    const [startDate, endDate] = dateRange.split('_');
                    const timestamp = localStorage.getItem(key);
                    const cacheKey = `${CACHE_KEYS.STORIES_DATERANGE}${dateRange}`;
                    const size = localStorage.getItem(cacheKey)?.length || 0;
                    
                    if (timestamp && startDate && endDate) {
                        info.storiesDateRanges.push({
                            dateRange: `${startDate} to ${endDate}`,
                            timestamp: new Date(parseInt(timestamp)),
                            expired: isCacheExpiredGeneric(key),
                            size: size
                        });
                    }
                }
            }
            
            return info;
        }
        
        async function loadVocabularyFromDate(date) {
            // Load both regular and story vocabulary files and merge them
            const [regularVocab, storyVocab] = await Promise.all([
                loadRegularVocabularyFromDate(date),
                loadStoryVocabularyFromDate(date)
            ]);
            
            // Merge the results
            const combinedData = [...regularVocab.data, ...storyVocab.data];
            const fromCache = regularVocab.fromCache && storyVocab.fromCache;
            
            return { data: combinedData, fromCache };
        }
        
        async function loadRegularVocabularyFromDate(date) {
            // Check cache first
            const cacheKey = `regular_${date}`;
            const cached = getCachedVocabulary(cacheKey);
            if (cached) {
                return { data: cached, fromCache: true };
            }
            
            const filename = `vocabulary - ${date}.yaml`;
            const url = VOCAB_BASE_URL + encodeURIComponent(filename);
            
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const yamlText = await response.text();
                const vocabularyData = jsyaml.load(yamlText);
                
                if (Array.isArray(vocabularyData)) {
                    const processedData = vocabularyData.map(word => ({
                        ...word,
                        date: date,
                        id: `${word.word}-${date}`,
                        source: 'regular'
                    }));
                    
                    // Cache the processed data
                    setCachedVocabulary(cacheKey, processedData);
                    
                    return { data: processedData, fromCache: false };
                }
                return { data: [], fromCache: false };
            } catch (error) {
                console.log(`Could not load regular vocabulary for ${date}:`, error.message);
                return { data: [], fromCache: false };
            }
        }
        
        async function loadStoryVocabularyFromDate(date) {
            // Check cache first
            const cacheKey = `story_${date}`;
            const cached = getCachedVocabulary(cacheKey);
            if (cached) {
                return { data: cached, fromCache: true };
            }
            
            const filename = `vocabulary from story - ${date}.yaml`;
            const url = VOCAB_BASE_URL + encodeURIComponent(filename);
            
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const yamlText = await response.text();
                const vocabularyData = jsyaml.load(yamlText);
                
                if (Array.isArray(vocabularyData)) {
                    const processedData = vocabularyData.map(word => ({
                        ...word,
                        date: date,
                        id: `${word.word}-story-${date}`,
                        source: 'story'
                    }));
                    
                    // Cache the processed data
                    setCachedVocabulary(cacheKey, processedData);
                    
                    return { data: processedData, fromCache: false };
                }
                return { data: [], fromCache: false };
            } catch (error) {
                console.log(`Could not load story vocabulary for ${date}:`, error.message);
                return { data: [], fromCache: false };
            }
        }

        function generateDateRange(startDate, endDate) {
            const dates = [];
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            while (start <= end) {
                dates.push(formatDate(start));
                start.setDate(start.getDate() + 1);
            }
            return dates;
        }
        
        // Debounce function for performance optimization
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        async function loadVocabularyForDateRange() {
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            const startDate = startDateInput.value;
            const endDate = endDateInput.value;
            
            // If only start date is selected, treat it as single date
            if (startDate && !endDate) {
                endDateInput.value = startDate;
            }
            
            // If only end date is selected, treat it as single date  
            if (!startDate && endDate) {
                startDateInput.value = endDate;
            }
            
            // Ensure start date is not after end date
            if (new Date(startDate) > new Date(endDate)) {
                const temp = startDate;
                startDateInput.value = endDate;
                endDateInput.value = temp;
                return loadVocabularyForDateRange();
            }
            
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            
            allVocabulary = [];
            loadedDates.clear();
            
            const dateRange = generateDateRange(startDateInput.value, endDateInput.value);
            
            // Load vocabulary data in parallel for better performance
            const loadPromises = dateRange.map(async (date) => {
                try {
                    const result = await loadVocabularyFromDate(date);
                    return { date, vocab: result.data, fromCache: result.fromCache };
                } catch (error) {
                    console.log(`Could not load vocabulary for ${date}:`, error.message);
                    return { date, vocab: [], fromCache: false };
                }
            });
            
            // Update loading indicator
            let cachedCount = 0;
            let totalCount = dateRange.length;
            
            const results = await Promise.all(loadPromises);
            
            // Process results and count cache hits
            results.forEach(({ date, vocab, fromCache }) => {
                if (fromCache) cachedCount++;
                if (vocab.length > 0) {
                    allVocabulary.push(...vocab);
                    loadedDates.add(date);
                }
            });
            
            // Show cache status briefly
            if (cachedCount > 0) {
                const cacheIndicator = document.getElementById('cacheIndicator');
                if (cachedCount === totalCount) {
                    cacheIndicator.textContent = `⚡ Loaded from cache (instant)`;
                } else {
                    cacheIndicator.textContent = `⚡ ${cachedCount}/${totalCount} from cache`;
                }
            }
            
            loading.style.display = 'none';
            
            // Clear cache indicator after a short delay
            setTimeout(() => {
                const cacheIndicator = document.getElementById('cacheIndicator');
                if (cacheIndicator) cacheIndicator.textContent = '';
            }, 2000);
            
            if (allVocabulary.length === 0) {
                document.getElementById('noResults').style.display = 'block';
                document.getElementById('noResults').textContent = `No vocabulary found for the selected date range.`;
                document.getElementById('vocabularyGrid').style.display = 'none';
            } else {
                currentVocabulary = [...allVocabulary];
                document.getElementById('noResults').style.display = 'none';
                renderVocabulary();
            }
            
            updateStats();
        }

        async function loadStoriesForDateRange() {
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            const startDate = startDateInput.value;
            const endDate = endDateInput.value;
            
            // If only start date is selected, treat it as single date
            if (startDate && !endDate) {
                endDateInput.value = startDate;
            }
            
            // If only end date is selected, treat it as single date  
            if (!startDate && endDate) {
                startDateInput.value = endDate;
            }
            
            if (!startDate || !endDate) {
                // Load all available stories if no date range is specified
                return loadAllAvailableStories();
            }
            
            // Check cache for date range first
            const cachedDateRangeStories = getCachedStoriesDateRange(startDate, endDate);
            if (cachedDateRangeStories) {
                allStories = cachedDateRangeStories;
                renderStories();
                return;
            }
            
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            document.getElementById('loadingText').textContent = 'Loading stories...';
            
            allStories = [];
            
            try {
                // Fetch the stories list from CSV
                const csvUrl = 'https://raw.githubusercontent.com/muhfaris/english-vocabulary/refs/heads/main/stories.csv';
                const csvResponse = await fetch(csvUrl);
                if (!csvResponse.ok) {
                    throw new Error('Failed to load stories list');
                }
                
                const csvText = await csvResponse.text();
                const lines = csvText.split('\n').filter(line => line.trim() && !line.startsWith('title'));
                
                for (const line of lines) {
                    const [title, date] = line.split(',').map(s => s.trim());
                    if (title) {
                        const filename = `story-${title}.yaml`;
                        try {
                            const url = STORIES_BASE_URL + encodeURIComponent(filename);
                            const response = await fetch(url);
                            if (response.ok) {
                                const yamlText = await response.text();
                                const storyData = jsyaml.load(yamlText);
                                
                                if (storyData && storyData.story) {
                                    const storyDate = storyData.story.date;
                                    
                                    // Check if story date falls within the selected range
                                    if (storyDate && isDateInRange(storyDate, startDateInput.value, endDateInput.value)) {
                                        const processedStory = {
                                            id: storyData.story.title || title,
                                            title: formatStoryTitle(storyData.story.title || title),
                                            date: storyDate,
                                            text: storyData.story.text,
                                            highlighted_words: storyData.story.highlighted_words || [],
                                            filename: filename
                                        };
                                        allStories.push(processedStory);
                                    }
                                }
                            }
                        } catch (error) {
                            console.log(`Could not load story ${filename}:`, error.message);
                        }
                    }
                }
            } catch (error) {
                console.error('Error loading stories list:', error);
                document.getElementById('storiesGrid').innerHTML = '<div class="no-results">Error loading stories list.</div>';
                loading.style.display = 'none';
                return;
            }
            
            // Cache the loaded date range stories
            setCachedStoriesDateRange(startDate, endDate, allStories);
            
            loading.style.display = 'none';
            
            if (allStories.length === 0) {
                document.getElementById('storiesGrid').innerHTML = '<div class="no-results">No stories found for the selected date range.</div>';
            } else {
                renderStories();
            }
        }
        
        async function loadAllAvailableStories() {
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            document.getElementById('loadingText').textContent = 'Loading stories...';
            
            // Check cache first
            const cachedStories = getCachedStories();
            if (cachedStories) {
                allStories = cachedStories;
                loading.style.display = 'none';
                renderStories();
                return;
            }
            
            allStories = [];
            
            try {
                // Fetch the stories list from CSV
                const csvUrl = 'https://raw.githubusercontent.com/muhfaris/english-vocabulary/refs/heads/main/stories.csv';
                const csvResponse = await fetch(csvUrl);
                if (!csvResponse.ok) {
                    throw new Error('Failed to load stories list');
                }
                
                const csvText = await csvResponse.text();
                const lines = csvText.split('\n').filter(line => line.trim() && !line.startsWith('title'));
                
                for (const line of lines) {
                    const [title, date] = line.split(',').map(s => s.trim());
                    if (title) {
                        const filename = `story-${title}.yaml`;
                        try {
                            const url = STORIES_BASE_URL + encodeURIComponent(filename);
                            const response = await fetch(url);
                            if (response.ok) {
                                const yamlText = await response.text();
                                const storyData = jsyaml.load(yamlText);
                                
                                if (storyData && storyData.story) {
                                    const processedStory = {
                                        id: storyData.story.title || title,
                                        title: formatStoryTitle(storyData.story.title || title),
                                        date: storyData.story.date,
                                        text: storyData.story.text,
                                        highlighted_words: storyData.story.highlighted_words || [],
                                        filename: filename
                                    };
                                    allStories.push(processedStory);
                                }
                            }
                        } catch (error) {
                            console.log(`Could not load story ${filename}:`, error.message);
                        }
                    }
                }
            } catch (error) {
                console.error('Error loading stories list:', error);
                document.getElementById('storiesGrid').innerHTML = '<div class="no-results">Error loading stories list.</div>';
                loading.style.display = 'none';
                return;
            }
            
            // Cache the loaded stories
            setCachedStories(allStories);
            
            loading.style.display = 'none';
            renderStories();
        }
        
        function isDateInRange(date, startDate, endDate) {
            const checkDate = new Date(date);
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            return checkDate >= start && checkDate <= end;
        }
        
        function handleDateRangeChange() {
            if (showingStories) {
                loadStoriesForDateRange();
            } else {
                loadVocabularyForDateRange();
            }
        }

        function formatStoryTitle(title) {
            return title.replace(/-/g, ' ')
                       .replace(/\b\w/g, l => l.toUpperCase());
        }

        function renderStories(stories = allStories) {
            const storiesGrid = document.getElementById('storiesGrid');
            
            if (stories.length === 0) {
                storiesGrid.innerHTML = '<div class="no-results">No stories available.</div>';
                return;
            }
            
            storiesGrid.innerHTML = stories.map(story => {
                const preview = story.text.substring(0, 200) + '...';
                const wordCount = story.highlighted_words ? story.highlighted_words.length : 0;
                
                return `
                    <div class="story-card" onclick="showStoryDetails('${story.id}')">
                        <div class="story-header">
                            <h3 class="story-title">${story.title}</h3>
                            <span class="story-date">${story.date}</span>
                        </div>
                        <p class="story-preview">${preview}</p>
                        <div class="story-vocabulary-count">
                            📝 ${wordCount} vocabulary words
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showStoryDetails(storyId) {
            const story = allStories.find(s => s.id === storyId);
            if (!story) return;
            
            const modal = document.getElementById('storyModal');
            const title = document.getElementById('storyModalTitle');
            const textElement = document.getElementById('storyText');
            
            title.textContent = story.title;
            
            // Process story text with highlighted words
            let processedText = story.text;
            
            if (story.highlighted_words && story.highlighted_words.length > 0) {
                story.highlighted_words.forEach(word => {
                    const regex = new RegExp(`\\*\\*(${word})\\*\\*`, 'gi');
                    processedText = processedText.replace(regex, 
                        `<span class="highlighted-word" onclick="showWordTooltip('$1')">
                            $1
                            <span class="word-tooltip">Click for definition</span>
                        </span>`);
                });
            }
            
            // Convert line breaks to paragraphs
            const paragraphs = processedText.split('\n\n').map(p => `<p>${p.trim()}</p>`).join('');
            textElement.innerHTML = paragraphs;
            
            const listenBtn = document.getElementById('listenToStoryBtn');
            listenBtn.onclick = () => {
                const textToSpeak = story.text.replace(/\*\*/g, '');
                speak(textToSpeak, 'en-US');
            };

            modal.style.display = 'block';
        }

        function showWordTooltip(word) {
            // Find the word in current vocabulary and show definition
            const wordObj = allVocabulary.find(w => w.word.toLowerCase() === word.toLowerCase());
            if (wordObj) {
                showWordDetails(wordObj.id);
            } else {
                alert(`Definition for "${word}" not found in loaded vocabulary.`);
            }
        }

        function closeStoryModal() {
            document.getElementById('storyModal').style.display = 'none';
            window.speechSynthesis.cancel();
        }

        function showDialogueDetails(dialogueId) {
            const dialogue = allDialogues.find(d => d.id === dialogueId);
            if (!dialogue) return;
            
            // Set modal title
            document.getElementById('dialogueModalTitle').textContent = dialogue.title;
            
            // Render conversation
            const speakers = [...new Set(dialogue.dialogue.map(line => line.speaker))];
            const conversationHtml = dialogue.dialogue.map((line, index) => {
                const speakerIndex = speakers.indexOf(line.speaker);
                const speakerClass = speakerIndex === 0 ? 'speaker-first' : 'speaker-second';
                return `
                    <div class="dialogue-line ${speakerClass}">
                        <div class="dialogue-speaker">${line.speaker}</div>
                        <div class="dialogue-text">${line.english}</div>
                        <div class="dialogue-bahasa" id="bahasa-${index}">${line.bahasa}</div>
                        <button class="toggle-translation" onclick="toggleTranslation(${index})">Show Translation</button>
                    </div>
                `;
            }).join('');
            document.getElementById('dialogueConversation').innerHTML = conversationHtml;
            
            // Render expressions
            const expressionsHtml = dialogue.expressions.map((expr, index) => `
                <div class="expression-item">
                    <div class="expression-phrase">"${expr.phrase}"</div>
                    <div class="expression-meaning">${expr.meaning_english}</div>
                    <div class="expression-bahasa" id="expr-bahasa-${index}">${expr.meaning_bahasa}</div>
                    <button class="toggle-translation" onclick="toggleExpressionTranslation(${index})">Show Indonesian</button>
                </div>
            `).join('');
            document.getElementById('dialogueExpressions').innerHTML = expressionsHtml;
            
            // Render questions
            const questionsHtml = dialogue.questions.map((question, index) => `
                <div class="question-item">
                    <div class="question-q">${question.q}</div>
                    <button class="show-answer-btn" onclick="toggleAnswer(${index})">Show Answer</button>
                    <div class="question-answer" id="answer-${index}">${question.a}</div>
                </div>
            `).join('');
            document.getElementById('dialogueQuestions').innerHTML = questionsHtml;
            
            // Show modal
            document.getElementById('dialogueModal').style.display = 'block';
        }

        function closeDialogueModal() {
            document.getElementById('dialogueModal').style.display = 'none';
        }

        function toggleCacheInfo() {
            const modal = document.getElementById('cacheInfoModal');
            const cacheDetailsDiv = document.getElementById('cacheDetails');
            
            // Get cache info
            const cacheInfo = getAllCacheInfo();
            
            // Build cache details HTML
            let detailsHtml = '<h4>📊 Cache Status:</h4>';
            
            // Vocabulary cache
            if (cacheInfo.vocabulary && cacheInfo.vocabulary.length > 0) {
                detailsHtml += '<div class="cache-detail-item">';
                detailsHtml += '<strong>📚 Vocabulary:</strong><br>';
                detailsHtml += `${cacheInfo.vocabulary.length} entries cached<br>`;
                const validEntries = cacheInfo.vocabulary.filter(v => !v.expired).length;
                const expiredEntries = cacheInfo.vocabulary.length - validEntries;
                detailsHtml += `${validEntries} valid, ${expiredEntries} expired`;
                detailsHtml += '</div>';
            }
            
            // Stories cache (all stories - rarely used since date range is auto-set)
            if (cacheInfo.stories) {
                const expiredClass = cacheInfo.stories.expired ? ' cache-expired' : '';
                detailsHtml += `<div class="cache-detail-item${expiredClass}">`;
                detailsHtml += '<strong>📖 All Stories:</strong><br>';
                detailsHtml += `Last updated: ${cacheInfo.stories.timestamp.toLocaleString()}<br>`;
                detailsHtml += `Status: ${cacheInfo.stories.expired ? 'Expired' : 'Valid'}`;
                detailsHtml += '</div>';
            }

            // Date range stories caches
            if (cacheInfo.storiesDateRanges && cacheInfo.storiesDateRanges.length > 0) {
                cacheInfo.storiesDateRanges.forEach((dateRangeCache, index) => {
                    const expiredClass = dateRangeCache.expired ? ' cache-expired' : '';
                    detailsHtml += `<div class="cache-detail-item${expiredClass}">`;
                    detailsHtml += '<strong>📖 Stories:</strong><br>';
                    detailsHtml += `Range: ${dateRangeCache.dateRange}<br>`;
                    detailsHtml += `Last updated: ${dateRangeCache.timestamp.toLocaleString()}<br>`;
                    detailsHtml += `Status: ${dateRangeCache.expired ? 'Expired' : 'Valid'}`;
                    detailsHtml += '</div>';
                });
            }
 
            
            // Dialogues cache
            if (cacheInfo.dialogues) {
                const expiredClass = cacheInfo.dialogues.expired ? ' cache-expired' : '';
                detailsHtml += `<div class="cache-detail-item${expiredClass}">`;
                detailsHtml += '<strong>💬 Dialogues:</strong><br>';
                detailsHtml += `Last updated: ${cacheInfo.dialogues.timestamp.toLocaleString()}<br>`;
                detailsHtml += `Status: ${cacheInfo.dialogues.expired ? 'Expired' : 'Valid'}`;
                detailsHtml += '</div>';
            } else {
                detailsHtml += '<div class="cache-detail-item cache-expired">';
                detailsHtml += '<strong>💬 Dialogues:</strong> Not cached yet';
                detailsHtml += '</div>';
            }
            
           
            cacheDetailsDiv.innerHTML = detailsHtml;
            modal.style.display = 'block';
        }

        function closeCacheInfo() {
            document.getElementById('cacheInfoModal').style.display = 'none';
        }

        function toggleTranslation(index) {
            const bahasaElement = document.getElementById(`bahasa-${index}`);
            const button = bahasaElement.nextElementSibling;
            
            if (bahasaElement.classList.contains('show')) {
                bahasaElement.classList.remove('show');
                button.textContent = 'Show Translation';
            } else {
                bahasaElement.classList.add('show');
                button.textContent = 'Hide Translation';
            }
        }

        function toggleExpressionTranslation(index) {
            const bahasaElement = document.getElementById(`expr-bahasa-${index}`);
            const button = bahasaElement.nextElementSibling;
            
            if (bahasaElement.classList.contains('show')) {
                bahasaElement.classList.remove('show');
                button.textContent = 'Show Indonesian';
            } else {
                bahasaElement.classList.add('show');
                button.textContent = 'Hide Indonesian';
            }
        }

        function toggleAnswer(index) {
            const answerElement = document.getElementById(`answer-${index}`);
            const button = answerElement.previousElementSibling;
            
            if (answerElement.classList.contains('show')) {
                answerElement.classList.remove('show');
                button.textContent = 'Show Answer';
            } else {
                answerElement.classList.add('show');
                button.textContent = 'Hide Answer';
            }
        }

        function showVocabulary() {
            if (!showingStories && !showingDialogues) return; // Already showing vocabulary
            
            const vocabularyGrid = document.getElementById('vocabularyGrid');
            const storiesGrid = document.getElementById('storiesGrid');
            const dialoguesGrid = document.getElementById('dialoguesGrid');
            const statsSection = document.getElementById('statsSection');
            const dateRangeContainer = document.getElementById('dateRangeContainer');
            const shuffleBtn = document.getElementById('shuffleBtn');
            const randomBtn = document.getElementById('randomBtn');
            const searchInput = document.getElementById('searchInput');
            
            showingStories = false;
            showingDialogues = false;
            
            // Show vocabulary elements
            vocabularyGrid.style.display = 'grid';
            statsSection.style.display = 'grid';
            dateRangeContainer.style.display = 'flex';
            shuffleBtn.style.display = 'inline-block';
            randomBtn.style.display = 'inline-block';
            
            // Hide stories and dialogues elements
            storiesGrid.style.display = 'none';
            dialoguesGrid.style.display = 'none';
            
            // Update search placeholder
            searchInput.placeholder = 'Search words, meanings, or workplace examples...';
            
            // Update menu active states for both desktop and mobile
            const vocabularyMenuItemDesktop = document.getElementById('vocabularyMenuItemDesktop');
            const storiesMenuItemDesktop = document.getElementById('storiesMenuItemDesktop');
            const dialoguesMenuItemDesktop = document.getElementById('dialoguesMenuItemDesktop');
            const vocabularyMenuItemMobile = document.getElementById('vocabularyMenuItemMobile');
            const storiesMenuItemMobile = document.getElementById('storiesMenuItemMobile');
            const dialoguesMenuItemMobile = document.getElementById('dialoguesMenuItemMobile');
            
            vocabularyMenuItemDesktop.classList.add('active');
            storiesMenuItemDesktop.classList.remove('active');
            dialoguesMenuItemDesktop.classList.remove('active');
            vocabularyMenuItemMobile.classList.add('active');
            storiesMenuItemMobile.classList.remove('active');
            dialoguesMenuItemMobile.classList.remove('active');
            
            // Update header
            document.getElementById('headerTitle').textContent = '💼 Daily Work Vocabulary Master';
            document.getElementById('headerSubtitle').textContent = 'Learn everyday vocabulary for software engineers - from meetings to code reviews';
            
            // Ensure stats are shown for vocabulary
            statsSection.style.display = 'grid';
            
            renderVocabulary();
        }
        
        function showStories() {
            if (showingStories) return; // Already showing stories
            
            const vocabularyGrid = document.getElementById('vocabularyGrid');
            const storiesGrid = document.getElementById('storiesGrid');
            const dialoguesGrid = document.getElementById('dialoguesGrid');
            const statsSection = document.getElementById('statsSection');
            const dateRangeContainer = document.getElementById('dateRangeContainer');
            const shuffleBtn = document.getElementById('shuffleBtn');
            const randomBtn = document.getElementById('randomBtn');
            const searchInput = document.getElementById('searchInput');
            
            const vocabularyMenuItem = document.getElementById('vocabularyMenuItem');
            const storiesMenuItem = document.getElementById('storiesMenuItem');
            
            showingStories = true;
            showingDialogues = false;
            
            // Hide vocabulary and dialogues elements
            vocabularyGrid.style.display = 'none';
            dialoguesGrid.style.display = 'none';
            statsSection.style.display = 'none';
            shuffleBtn.style.display = 'none';
            randomBtn.style.display = 'none';
            
            // Show stories elements and date range for stories
            storiesGrid.style.display = 'grid';
            dateRangeContainer.style.display = 'flex';
            
            // Update search placeholder
            searchInput.placeholder = 'Search stories...';
            
            // Update menu active states for both desktop and mobile
            const vocabularyMenuItemDesktop = document.getElementById('vocabularyMenuItemDesktop');
            const storiesMenuItemDesktop = document.getElementById('storiesMenuItemDesktop');
            const dialoguesMenuItemDesktop = document.getElementById('dialoguesMenuItemDesktop');
            const vocabularyMenuItemMobile = document.getElementById('vocabularyMenuItemMobile');
            const storiesMenuItemMobile = document.getElementById('storiesMenuItemMobile');
            const dialoguesMenuItemMobile = document.getElementById('dialoguesMenuItemMobile');
            
            vocabularyMenuItemDesktop.classList.remove('active');
            storiesMenuItemDesktop.classList.add('active');
            dialoguesMenuItemDesktop.classList.remove('active');
            vocabularyMenuItemMobile.classList.remove('active');
            storiesMenuItemMobile.classList.add('active');
            dialoguesMenuItemMobile.classList.remove('active');
            
            // Update header
            document.getElementById('headerTitle').textContent = '📖 Professional Stories';
            document.getElementById('headerSubtitle').textContent = 'Read workplace stories with highlighted vocabulary words';
            
            loadStoriesForDateRange();
        }

        function showDialogues() {
            if (showingDialogues) return; // Already showing dialogues
            
            const vocabularyGrid = document.getElementById('vocabularyGrid');
            const storiesGrid = document.getElementById('storiesGrid');
            const dialoguesGrid = document.getElementById('dialoguesGrid');
            const statsSection = document.getElementById('statsSection');
            const dateRangeContainer = document.getElementById('dateRangeContainer');
            const shuffleBtn = document.getElementById('shuffleBtn');
            const randomBtn = document.getElementById('randomBtn');
            const searchInput = document.getElementById('searchInput');
            
            showingStories = false;
            showingDialogues = true;
            
            // Hide vocabulary and stories elements
            vocabularyGrid.style.display = 'none';
            storiesGrid.style.display = 'none';
            statsSection.style.display = 'none';
            shuffleBtn.style.display = 'none';
            randomBtn.style.display = 'none';
            dateRangeContainer.style.display = 'none';
            
            // Show dialogues elements
            dialoguesGrid.style.display = 'grid';
            
            // Update search placeholder
            searchInput.placeholder = 'Search dialogues...';
            
            // Update menu active states for both desktop and mobile
            const vocabularyMenuItemDesktop = document.getElementById('vocabularyMenuItemDesktop');
            const storiesMenuItemDesktop = document.getElementById('storiesMenuItemDesktop');
            const dialoguesMenuItemDesktop = document.getElementById('dialoguesMenuItemDesktop');
            const vocabularyMenuItemMobile = document.getElementById('vocabularyMenuItemMobile');
            const storiesMenuItemMobile = document.getElementById('storiesMenuItemMobile');
            const dialoguesMenuItemMobile = document.getElementById('dialoguesMenuItemMobile');
            
            vocabularyMenuItemDesktop.classList.remove('active');
            storiesMenuItemDesktop.classList.remove('active');
            dialoguesMenuItemDesktop.classList.add('active');
            vocabularyMenuItemMobile.classList.remove('active');
            storiesMenuItemMobile.classList.remove('active');
            dialoguesMenuItemMobile.classList.add('active');
            
            // Update header
            document.getElementById('headerTitle').textContent = '💬 Interactive Dialogues';
            document.getElementById('headerSubtitle').textContent = 'Practice conversations with hidden translations and comprehension questions';
            
            loadAllAvailableDialogues();
        }

        async function loadAllAvailableDialogues() {
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            document.getElementById('loadingText').textContent = 'Loading dialogues...';
            
            // Check cache first
            const cachedDialogues = getCachedDialogues();
            if (cachedDialogues) {
                allDialogues = cachedDialogues;
                loading.style.display = 'none';
                renderDialogues();
                return;
            }
            
            allDialogues = [];
            
            try {
                // Fetch the dialogues list from CSV
                const csvUrl = 'https://raw.githubusercontent.com/muhfaris/english-vocabulary/refs/heads/main/dialogues.csv';
                const csvResponse = await fetch(csvUrl);
                if (!csvResponse.ok) {
                    throw new Error('Failed to load dialogues list');
                }
                
                const csvText = await csvResponse.text();
                const lines = csvText.split('\n').filter(line => line.trim() && !line.startsWith('title'));
                
                for (const line of lines) {
                    const [title, date] = line.split(',').map(s => s.trim());
                    if (title) {
                        const filename = `${title}.yaml`;
                        try {
                            const url = DIALOGUES_BASE_URL + encodeURIComponent(filename);
                            const response = await fetch(url);
                            if (response.ok) {
                                const yamlText = await response.text();
                                const dialogueData = jsyaml.load(yamlText);
                                
                                if (dialogueData) {
                                    const processedDialogue = {
                                        id: title,
                                        title: formatDialogueTitle(title),
                                        date: date,
                                        dialogue: dialogueData.dialogue || [],
                                        expressions: dialogueData.expressions || [],
                                        questions: dialogueData.questions || [],
                                        filename: filename
                                    };
                                    allDialogues.push(processedDialogue);
                                }
                            }
                        } catch (error) {
                            console.log(`Could not load dialogue ${filename}:`, error.message);
                        }
                    }
                }
            } catch (error) {
                console.error('Error loading dialogues list:', error);
                document.getElementById('dialoguesGrid').innerHTML = '<div class="no-results">Error loading dialogues list.</div>';
                loading.style.display = 'none';
                return;
            }
            
            // Cache the loaded dialogues
            setCachedDialogues(allDialogues);
            
            loading.style.display = 'none';
            renderDialogues();
        }

        function formatDialogueTitle(title) {
            return title.replace(/-/g, ' ')
                       .replace(/\b\w/g, l => l.toUpperCase());
        }

        function renderDialogues(dialogues = allDialogues) {
            const dialoguesGrid = document.getElementById('dialoguesGrid');
            
            if (dialogues.length === 0) {
                dialoguesGrid.innerHTML = '<div class="no-results">No dialogues available.</div>';
                return;
            }
            
            dialoguesGrid.innerHTML = dialogues.map(dialogue => {
                const preview = dialogue.dialogue.length > 0 ? 
                    dialogue.dialogue.slice(0, 2).map(line => `${line.speaker}: ${line.english}`).join(' | ') + '...' : 
                    'Interactive dialogue available';
                const speakersCount = [...new Set(dialogue.dialogue.map(line => line.speaker))].length;
                const expressionsCount = dialogue.expressions.length;
                const questionsCount = dialogue.questions.length;
                
                return `
                    <div class="dialogue-card" onclick="showDialogueDetails('${dialogue.id}')">
                        <div class="dialogue-header">
                            <h3 class="dialogue-title">${dialogue.title}</h3>
                            <span class="dialogue-date">${dialogue.date}</span>
                        </div>
                        <p class="dialogue-preview">${preview}</p>
                        <div class="dialogue-stats">
                            <span class="dialogue-stat">👥 ${speakersCount} speakers</span>
                            <span class="dialogue-stat">💭 ${dialogue.dialogue.length} exchanges</span>
                            <span class="dialogue-stat">📝 ${expressionsCount} expressions</span>
                            <span class="dialogue-stat">❓ ${questionsCount} questions</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderVocabulary(words = currentVocabulary) {
            const grid = document.getElementById('vocabularyGrid');
            const noResults = document.getElementById('noResults');
            
            if (words.length === 0) {
                grid.style.display = 'none';
                noResults.style.display = 'block';
                noResults.textContent = 'No words found matching your search.';
                return;
            }
            
            grid.style.display = 'grid';
            noResults.style.display = 'none';
            
            grid.innerHTML = words.map(wordObj => `
                <div class="word-card" onclick="showWordDetails('${wordObj.id}')">
                    <div class="word-title">
                        <span>${wordObj.word}</span>
                        <span class="speaker-icon" onclick="speak('${wordObj.word.replace(/'/g, `\\'`)}', 'en-US', event)">🔊</span>
                        ${wordObj.part_of_speech ? `<span style="font-size: 0.7rem; background: #667eea; color: white; padding: 4px 8px; border-radius: 10px; text-transform: uppercase; font-weight: 600;">${wordObj.part_of_speech}</span>` : ''}
                        ${wordObj.source === 'story' ? `<span style="font-size: 0.7rem; background: #ff6b6b; color: white; padding: 4px 8px; border-radius: 10px; text-transform: uppercase; font-weight: 600; margin-left: 8px;">📖 Story</span>` : ''}
                    </div>
                    
                    ${wordObj.pronunciation ? `<div style="font-family: monospace; color: #764ba2; font-size: 1rem; margin-bottom: 15px; font-weight: 600;">${wordObj.pronunciation}</div>` : ''}
                    
                    <div class="word-meaning">
                        <h4>English</h4>
                        <p>${wordObj.meaning.english}</p>
                    </div>
                    
                    <div class="word-usage">
                        <strong>Usage:</strong> ${wordObj.usage}
                    </div>
               </div>
            `).join('');
            
            updateStats(words.length);
        }

        function updateStats(displayed = currentVocabulary.length) {
            document.getElementById('totalWords').textContent = allVocabulary.length;
            document.getElementById('displayedWords').textContent = displayed;
            document.getElementById('learnedWords').textContent = learnedCount;
            document.getElementById('loadedDates').textContent = loadedDates.size;
        }

        function showWordDetails(wordId) {
            const wordObj = allVocabulary.find(w => w.id === wordId);
            if (!wordObj) return;
            
            const modal = document.getElementById('wordModal');
            const title = document.getElementById('modalTitle');
            const dateElement = document.getElementById('modalDate');
            const body = document.getElementById('modalBody');
            
            title.innerHTML = `${wordObj.word} <span class="speaker-icon" onclick="speak('${wordObj.word.replace(/'/g, `\\'`)}')">🔊</span>`;
            
            // Hide the date element in modal
            dateElement.style.display = 'none';
            
            body.innerHTML = `
                ${wordObj.pronunciation || wordObj.part_of_speech ? `
                <div class="modal-section">
                    <h3>📚 Word Details</h3>
                    ${wordObj.pronunciation ? `<div style="margin-bottom: 10px;"><strong>Pronunciation:</strong> <span style="font-family: monospace; color: #667eea; font-size: 1.1rem;">${wordObj.pronunciation}</span></div>` : ''}
                    ${wordObj.part_of_speech ? `<div style="margin-bottom: 10px;"><strong>Part of Speech:</strong> <span style="background: #667eea; color: white; padding: 4px 12px; border-radius: 15px; text-transform: capitalize; font-weight: 600;">${wordObj.part_of_speech}</span></div>` : ''}
                    ${wordObj.synonyms && wordObj.synonyms.length > 0 ? `<div><strong>Synonyms:</strong> ${wordObj.synonyms.map(syn => `<span style="background: #f8f9fa; color: #555; padding: 2px 8px; border-radius: 12px; margin: 0 4px; font-size: 0.9rem;">${syn}</span>`).join('')}</div>` : ''}
                </div>
                ` : ''}
                
                <div class="modal-section">
                    <h3>🎯 Meaning</h3>
                    <div style="margin-bottom: 15px;">
                        <strong>English:</strong><br>
                        <div style="font-size: 1.2rem; margin-top: 8px; line-height: 1.6;">${wordObj.meaning.english}</div>
                    </div>
                    <div>
                        <strong>Bahasa Indonesia:</strong><br>
                        <div style="font-size: 1.1rem; margin-top: 8px; line-height: 1.6; color: #666;">${wordObj.meaning.bahasa}</div>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h3>💡 Usage Guide</h3>
                    <div style="font-size: 1.1rem; line-height: 1.7; color: #555;">${wordObj.usage}</div>
                </div>
                
                ${wordObj.examples ? `
                <div class="modal-section">
                    <h3>📝 Examples</h3>
                    ${wordObj.examples.workplace ? `
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #764ba2; margin-bottom: 10px;">🏢 Workplace Context</h4>
                            ${wordObj.examples.workplace.map(ex => `<div class="example-item">"${ex}"</div>`).join('')}
                        </div>
                    ` : ''}
                    ${wordObj.examples.casual ? `
                        <div>
                            <h4 style="color: #764ba2; margin-bottom: 10px;">💬 Casual Context</h4>
                            ${wordObj.examples.casual.map(ex => `<div class="example-item">"${ex}"</div>`).join('')}
                        </div>
                    ` : ''}
                </div>
                ` : ''}
                
                ${wordObj.related && wordObj.related.length > 0 ? `
                <div class="modal-section">
                    <h3>🔗 Related Words</h3>
                    <div class="related-words">
                        ${wordObj.related.map(rel => `
                            <div class="related-word">
                                <h4>${rel.word}</h4>
                                <p>${rel.difference}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                ${wordObj.story ? `
                <div class="modal-section">
                    <h3>📖 Context Story</h3>
                    <div class="story-section">
                        ${wordObj.story.split('\n').map(paragraph => `<p style="margin-bottom: 15px;">${paragraph}</p>`).join('')}
                    </div>
                </div>
                ` : ''}
                
                <div class="modal-actions">
                    <button class="btn" onclick="markAsLearned('${wordObj.id}')">✅ Mark as Learned</button>
                    <button class="btn secondary" onclick="closeModal()">📚 Continue Learning</button>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function markAsLearned(wordId) {
            learnedCount++;
            updateStats();
            closeModal();
        }

        function closeModal() {
            document.getElementById('wordModal').style.display = 'none';
            window.speechSynthesis.cancel();
        }

        function shuffleWords() {
            currentVocabulary = [...currentVocabulary].sort(() => Math.random() - 0.5);
            renderVocabulary();
        }

        let currentFlashCard = null;
        
        function showRandomWord() {
            if (currentVocabulary.length === 0) {
                alert('Please load vocabulary first!');
                return;
            }
            showRandomFlashCard();
        }
        
        function showRandomFlashCard() {
            const randomWord = currentVocabulary[Math.floor(Math.random() * currentVocabulary.length)];
            currentFlashCard = randomWord;
            showFlashCard(randomWord);
        }
        
        function showFlashCard(wordObj) {
            const modal = document.getElementById('flashCardModal');
            const flashCard = document.getElementById('flashCard');
            
            // Reset card to front side
            flashCard.classList.remove('flipped');
            
            // Fill front side
            document.getElementById('flashCardWord').textContent = wordObj.word;
            document.getElementById('flashCardDate').textContent = wordObj.date || '';
            
            // Fill back side
            const meaningDiv = document.getElementById('flashMeaning');
            meaningDiv.innerHTML = `
                <h3>English</h3>
                <p>${wordObj.meaning.english}</p>
                <h3>Bahasa Indonesia</h3>
                <p>${wordObj.meaning.bahasa}</p>
            `;
            
            document.getElementById('flashUsage').textContent = wordObj.usage;
            
            // Show a random example if available
            const exampleDiv = document.getElementById('flashExample');
            if (wordObj.examples) {
                let allExamples = [];
                if (wordObj.examples.workplace) allExamples.push(...wordObj.examples.workplace);
                if (wordObj.examples.casual) allExamples.push(...wordObj.examples.casual);
                
                if (allExamples.length > 0) {
                    const randomExample = allExamples[Math.floor(Math.random() * allExamples.length)];
                    exampleDiv.textContent = `"${randomExample}"`;
                } else {
                    exampleDiv.textContent = '';
                }
            } else {
                exampleDiv.textContent = '';
            }
            
            modal.style.display = 'block';
        }
        
        function closeFlashCard() {
            document.getElementById('flashCardModal').style.display = 'none';
            currentFlashCard = null;
            window.speechSynthesis.cancel();
        }
        
        function showNextFlashCard() {
            if (currentVocabulary.length === 0) return;
            showRandomFlashCard();
        }
        
        function markFlashCardLearned() {
            if (currentFlashCard) {
                learnedCount++;
                updateStats();
                showNextFlashCard();
            }
        }

        function searchWords() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            if (!searchTerm) {
                if (showingStories) {
                    renderStories();
                } else if (showingDialogues) {
                    renderDialogues();
                } else {
                    renderVocabulary();
                }
                return;
            }
            
            if (showingStories) {
                // Search stories
                const filteredStories = allStories.filter(story => 
                    story.title.toLowerCase().includes(searchTerm) ||
                    story.text.toLowerCase().includes(searchTerm) ||
                    (story.highlighted_words && story.highlighted_words.some(word => word.toLowerCase().includes(searchTerm)))
                );
                renderStories(filteredStories);
            } else if (showingDialogues) {
                // Search dialogues
                const filteredDialogues = allDialogues.filter(dialogue => 
                    dialogue.title.toLowerCase().includes(searchTerm) ||
                    dialogue.dialogue.some(line => 
                        line.english.toLowerCase().includes(searchTerm) ||
                        line.bahasa.toLowerCase().includes(searchTerm) ||
                        line.speaker.toLowerCase().includes(searchTerm)
                    ) ||
                    dialogue.expressions.some(expr => 
                        expr.phrase.toLowerCase().includes(searchTerm) ||
                        expr.meaning_english.toLowerCase().includes(searchTerm) ||
                        expr.meaning_bahasa.toLowerCase().includes(searchTerm)
                    )
                );
                renderDialogues(filteredDialogues);
            } else {
                // Search vocabulary
                const filteredWords = currentVocabulary.filter(wordObj => 
                    wordObj.word.toLowerCase().includes(searchTerm) ||
                    wordObj.meaning.english.toLowerCase().includes(searchTerm) ||
                    wordObj.meaning.bahasa.toLowerCase().includes(searchTerm) ||
                    wordObj.usage.toLowerCase().includes(searchTerm) ||
                    (wordObj.examples && (
                        (wordObj.examples.workplace && wordObj.examples.workplace.some(ex => ex.toLowerCase().includes(searchTerm))) ||
                        (wordObj.examples.casual && wordObj.examples.casual.some(ex => ex.toLowerCase().includes(searchTerm)))
                    )) ||
                    (wordObj.related && wordObj.related.some(rel => rel.word.toLowerCase().includes(searchTerm))) ||
                    (wordObj.story && wordObj.story.toLowerCase().includes(searchTerm))
                );
                renderVocabulary(filteredWords);
            }
        }

        // Event listeners with debounced search for better performance
        document.getElementById('searchInput').addEventListener('input', debounce(searchWords, 300));
        
        // Close modal when clicking outside
        document.getElementById('wordModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Close story modal when clicking outside
        document.getElementById('storyModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeStoryModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
                closeFlashCard();
                closeStoryModal();
                window.speechSynthesis.cancel();
            }
        });
        
        // Flash card flip on click
        document.addEventListener('DOMContentLoaded', function() {
            const flashCard = document.getElementById('flashCard');
            if (flashCard) {
                flashCard.addEventListener('click', function() {
                    this.classList.toggle('flipped');
                });
            }
        });

        
        // Set today's date and auto-load vocabulary on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Clean expired cache on startup
            clearOldCache();
            
            const startDate = document.getElementById('startDate');
            const endDate = document.getElementById('endDate');
            const today = formatDate(new Date());
            
            // Set both dates to today by default
            startDate.value = today;
            endDate.value = today;
            
            // Allow selecting current date and past dates (no max restriction for now)
            // You can uncomment the lines below if you want to restrict future dates
            // startDate.max = today;
            // endDate.max = today;
            
            // Load vocabulary for today
            loadVocabularyForDateRange();
        });
    </script>
</body>
</html>
